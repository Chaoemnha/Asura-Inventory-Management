<div class="x_panel">
  <div class="x_title">
    <h2>Edit Transaction #{{ transactionId }}</h2>
    <div class="clearfix"></div>
  </div>

  <div class="x_content" *ngIf="isAdmin()">
    <form class="form-horizontal form-label-left" (ngSubmit)="onSubmit()">

      <!-- Product Selection -->
      <div class="form-group">
        <div class="row">
          <label class="control-label col-md-3 col-sm-3 col-12" for="productId">
            Product <span class="required">*</span>
          </label>
          <div class="col-md-6 col-sm-6 col-12">
            <select
              id="productId"
              [(ngModel)]="formData.productId"
              name="productId"
              class="form-control"
              (change)="onProductChange()"
              required>
              <option value="">Select a product</option>
              <option *ngFor="let product of products" [value]="product.id">
                {{ product.name }} - {{ product.sku }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Quantity -->
      <div class="form-group">
        <div class="row">
          <label class="control-label col-md-3 col-sm-3 col-12" for="quantity">
            Quantity <span class="required">*</span>
          </label>
          <div class="col-md-6 col-sm-6 col-12">
            <input
              type="number"
              id="quantity"
              [(ngModel)]="formData.quantity"
              name="quantity"
              placeholder="Enter quantity"
              class="form-control"
              min="1"
              (input)="onQuantityChange()"
              required>
          </div>
        </div>
      </div>

      <!-- Total Price -->
      <div class="form-group">
        <div class="row">
          <label class="control-label col-md-3 col-sm-3 col-12" for="totalPrice">
            Total Price
          </label>
          <div class="col-md-6 col-sm-6 col-12">
            <input
              type="number"
              id="totalPrice"
              [(ngModel)]="formData.totalPrice"
              name="totalPrice"
              placeholder="Total price (auto-calculated)"
              class="form-control"
              step="0.01">
          </div>
        </div>
      </div>

      <!-- Supplier Selection -->
      <div class="form-group">
        <div class="row">
          <label class="control-label col-md-3 col-sm-3 col-12" for="supplierId">
            Supplier
          </label>
          <div class="col-md-6 col-sm-6 col-12">
            <select
              id="supplierId"
              [(ngModel)]="formData.supplierId"
              name="supplierId"
              class="form-control"
              (change)="onSupplierChange()">
              <option value="">Select a supplier</option>
              <option *ngFor="let supplier of suppliers" [value]="supplier.id">
                {{ supplier.name }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- User Selection -->
      <div class="form-group">
        <div class="row">
          <label class="control-label col-md-3 col-sm-3 col-12" for="userId">
            User
          </label>
          <div class="col-md-6 col-sm-6 col-12">
            <select
              id="userId"
              [(ngModel)]="formData.userId"
              name="userId"
              class="form-control">
              <option value="">Select a user</option>
              <option *ngFor="let user of users" [value]="user.id">
                {{ user.name }} ({{ user.role }})
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Sender Selection -->
      <div class="form-group" *ngIf="availableSenders.length > 0">
        <div class="row">
          <label class="control-label col-md-3 col-sm-3 col-12" for="senderId">
            Sender
          </label>
          <div class="col-md-6 col-sm-6 col-12">
            <select
              id="senderId"
              [(ngModel)]="formData.senderId"
              name="senderId"
              class="form-control">
              <option value="">Select a sender</option>
              <option *ngFor="let sender of availableSenders" [value]="sender.id">
                {{ sender.name }} - {{ sender.email }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Status -->
      <div class="form-group">
        <div class="row">
          <label class="control-label col-md-3 col-sm-3 col-12" for="status">
            Status
          </label>
          <div class="col-md-6 col-sm-6 col-12">
            <select
              id="status"
              [(ngModel)]="formData.status"
              name="status"
              class="form-control">
              <option value="">Select status</option>
              <option *ngFor="let status of statusOptions" [value]="status.value">
                {{ status.label }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Description -->
      <div class="form-group">
        <div class="row">
          <label class="control-label col-md-3 col-sm-3 col-12" for="description">
            Description
          </label>
          <div class="col-md-6 col-sm-6 col-12">
            <textarea
              id="description"
              [(ngModel)]="formData.description"
              name="description"
              placeholder="Enter description"
              class="form-control"
              rows="3">
            </textarea>
          </div>
        </div>
      </div>

      <!-- Submit Buttons -->
      <div class="form-group">
        <div class="row">
          <div class="col-md-6 col-sm-6 col-12 col-md-offset-3">
            <button type="submit" class="btn btn-success mr-2">
              <i class="fa fa-save"></i> Update Transaction
            </button>
            <button type="button" class="btn btn-secondary" (click)="cancel()">
              <i class="fa fa-times"></i> Cancel
            </button>
          </div>
        </div>
      </div>

    </form>
  </div>

  <!-- Access Denied Message -->
  <div class="x_content" *ngIf="!isAdmin()">
    <div class="alert alert-danger">
      <i class="fa fa-exclamation-triangle"></i>
      <strong>Access Denied!</strong> Only administrators can edit transactions.
    </div>
  </div>
</div>