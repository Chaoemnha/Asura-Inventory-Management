<div class="x_panel">
  <div class="dashboard-container">
    <div class="row x_title align-items-center">
      <div class="col">
        <h1>Biá»ƒu Ä‘á»“ phÃ¢n tÃ­ch</h1>
      </div>
      <div class="col">
        <!-- Dashboard Controls -->
        <div *ngIf="isAdmin()||isStockstaff()" class="pull-right">
          <div class="row align-items-center justify-content-center">
            <div class="col-4">
              <label class="form-label mb-0 mr-1">ThÃ¡ng:</label>
              <select class="form-control form-control-sm d-inline-block" style="width: auto;"
                [(ngModel)]="selectedMonth">
                <option value="">Táº¥t cáº£</option>
                <option *ngFor="let month of months" [value]="month.value">{{ month.name }}</option>
              </select>
            </div>

            <div class="col-4">
              <label class="form-label mb-0 mr-1">NÄƒm:</label>
              <select class="form-control form-control-sm d-inline-block" style="width: auto;"
                [(ngModel)]="selectedYear">
                <option value="">Táº¥t cáº£</option>
                <option *ngFor="let year of years" [value]="year">{{ year }}</option>
              </select>
            </div>

            <div class="col-4">
              <label class="form-label mb-0 mr-1">Giá»›i háº¡n:</label>
              <select class="form-control form-control-sm d-inline-block" style="width: auto;"
                [(ngModel)]="selectedLimit">
                <option value="5">Top 5</option>
                <option value="10">Top 10</option>
                <option value="15">Top 15</option>
                <option value="20">Top 20</option>
              </select>
            </div>

            <div class="col-6">
              <div class="btn-group d-flex justify-content-around" role="group">
                <button class="btn btn-primary btn-sm" (click)="loadMonthlyData()" title="Ãp dá»¥ng bá»™ lá»c vÃ  hiá»ƒn thá»‹ dá»¯ liá»‡u">
                  <i class="fa fa-search"></i> Hiá»ƒn thá»‹
                </button>
                <button class="btn btn-secondary btn-sm" (click)="clearFilters()" title="XÃ³a táº¥t cáº£ bá»™ lá»c">
                  <i class="fa fa-eraser"></i> XÃ³a
                </button>
                <button class="btn btn-info btn-sm" (click)="refreshDashboard()" title="LÃ m má»›i táº¥t cáº£ biá»ƒu Ä‘á»“">
                  <i class="fa fa-refresh"></i> LÃ m má»›i
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row x_title">
      <!-- Summary Statistics Card -->
      <div *ngIf="(isAdmin()) && transactions.length > 0" class="col-12">
        <div class="col-md-12">
          <div class="alert alert-success">
            <h6><i class="fa fa-summary"></i> Tá»•ng quan tÃ i chÃ­nh ({{ getSelectedMonthName() }}):</h6>
            <div class="row text-center">
              <div class="col-md-2">
                <strong style="color: green;">ðŸ’° Doanh thu bÃ¡n</strong><br>
                <span class="h5">{{ (calculateSummaryStats().totalSales | number:'1.0-0') }} Ä‘</span>
              </div>
              <div class="col-md-2">
                <strong style="color: red;">ðŸ’¸ Chi phÃ­ nháº­p</strong><br>
                <span class="h5">{{ (calculateSummaryStats().totalPurchases | number:'1.0-0') }} Ä‘</span>
              </div>
              <div class="col-md-2">
                <strong style="color: orange;">ðŸ”„ GiÃ¡ trá»‹ hoÃ n tráº£</strong><br>
                <span class="h5">{{ (calculateSummaryStats().totalReturns | number:'1.0-0') }} Ä‘</span>
              </div>
              <div class="col-md-3">
                <strong [style.color]="getNetRevenueColor()">ðŸ“Š Lá»£i nhuáº­n rÃ²ng</strong><br>
                <span class="h4" [style.color]="getNetRevenueColor()">
                  {{ (calculateSummaryStats().netRevenue | number:'1.0-0') }} Ä‘
                </span>
              </div>
              <div class="col-md-3">
                <strong style="color: blue;">ðŸ“ˆ Tá»•ng giao dá»‹ch</strong><br>
                <span class="h5">{{ calculateSummaryStats().totalTransactions }} giao dá»‹ch</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="monthlyTransactionData.length&&(isAdmin())">
      <div class="col-12"><!-- Monthly Transaction Bar Chart -->
        <h5 *ngIf="isAdmin()||isStockstaff()" style="margin-bottom: 20px;" class="tiles">Biá»ƒu Ä‘á»“ giao dá»‹ch hÃ ng thÃ¡ng</h5>
      </div>
        <ngx-charts-bar-vertical [view]="view" [scheme]="'flame'" [results]="monthlyTransactionData"
          [gradient]="false" [xAxis]="true" [yAxis]="true" [legend]="showLegend" [showXAxisLabel]="true"
          [showYAxisLabel]="true" xAxisLabel="NgÃ y trong thÃ¡ng" yAxisLabel="Lá»£i nhuáº­n rÃ²ng (VND)" [animations]="animations">
        </ngx-charts-bar-vertical>
      </div>
      <div class="col-12"><!-- Transaction Type Count Bar Chart -->
        <div style="margin-bottom: 30px;">
          <h5>Sá»‘ lÆ°á»£ng giao dá»‹ch theo loáº¡i</h5>
          <ngx-charts-bar-vertical [view]="view" [scheme]="'vivid'" [results]="transactionTypeData" [gradient]="false"
            [xAxis]="true" [yAxis]="true" [legend]="showLegend" [showXAxisLabel]="true" [showYAxisLabel]="true"
            xAxisLabel="Loáº¡i giao dá»‹ch" yAxisLabel="Sá»‘ lÆ°á»£ng" [animations]="animations">
          </ngx-charts-bar-vertical>
        </div>
      </div>
      <div class="col-12"><!-- Transaction Amount by Type Pie Chart -->
        <div *ngIf="isAdmin()||isStockstaff()" style="margin-bottom: 30px;" class="tiles">
          <h5>GiÃ¡ trá»‹ giao dá»‹ch theo loáº¡i</h5>
          <ngx-charts-pie-chart [view]="view" [scheme]="'cool'" [results]="transactionAmountData" [legend]="showLegend"
            [labels]="showLabels" [doughnut]="false" [animations]="animations">
          </ngx-charts-pie-chart>
        </div>
      </div>
      <div class="col-12"><!-- Top Inventory Products Chart -->
        <div *ngIf="topInventoryProducts.length&&(isAdmin()||isStockstaff())" style="margin-bottom: 30px;" class="tiles">
          <h5>Top {{ selectedLimit }} sáº£n pháº©m - Tá»“n kho cao nháº¥t</h5>
          <ngx-charts-bar-horizontal [view]="view" [scheme]="'ocean'" [results]="topInventoryProducts"
            [gradient]="false" [xAxis]="true" [yAxis]="true" [legend]="showLegend" [showXAxisLabel]="true"
            [showYAxisLabel]="true" xAxisLabel="Sá»‘ lÆ°á»£ng tá»“n kho (Ä‘Æ¡n vá»‹)" yAxisLabel="Sáº£n pháº©m" [animations]="animations">
          </ngx-charts-bar-horizontal>
        </div>
      </div>
      <div class="col-12"><!-- Best Selling Products Chart -->
        <div *ngIf="bestSellingProducts.length&&(isAdmin()||isStockstaff())" style="margin-bottom: 30px;" class="tiles">
          <h5>Top {{ selectedLimit }} sáº£n pháº©m bÃ¡n cháº¡y nháº¥t</h5>
           <ngx-charts-pie-chart [view]="view" [scheme]="'natural'" [results]="bestSellingProducts"
            [legend]="showLegend" [labels]="showLabels" [doughnut]="true" [animations]="animations">
          </ngx-charts-pie-chart>
        </div>
      </div>
    </div>
  </div>
</div>